{% extends "base.html" %}

{% load staticfiles %}

{% block head %}
Blog - {{ title }}
{% endblock %}

{% block main_content %}
<div class="container _bgColor0">
    <div class="row">
        <div class="col-xs-12 col-md-12">
            <form method="post" action="" id="post_form" enctype="multipart/form-data" novalidate>
                {% csrf_token %}
                <div>
                    <!-- Titulo del post -->
                    <div class="form-group col-xs-12 _pl-0 _pr-0">
                        <label for="title">Titulo</label>
                        <input id="title" name="title" type="text" class="form-control" placeholder="enter your title here" maxlength="120" value="{{ post.title }}">
                    </div>
                    <!-- Categorias, status y fecha-->
                    <div class="col-xs-12 _pl-0 _pr-0">
                        <!-- Categorías -->
                        <div class="form-group col-xs-12 col-sm-6 pull-left _pl-0 _pr-0">
                            <label> Categorías </label><br>
                            {% for category in categories %}
                            <input type="checkbox" name="postcategory" value="{{ category.id }}" id="categoria_{{ category.id }}" autocomplete="off"
                                   {% for cat in post.postcategory_set.all %}
                                   {% if cat.category.id== category.id %}
                                   checked
                                   {% endif %}
                                   {% endfor %}/>
                            <div class="btn-group">
                                <label for="categoria_{{ category.id }}" class="btn btn-sm btn-{{ category.css_class}}">
                                    <span class="glyphicon glyphicon-ok"></span>
                                    <span> </span>
                                </label>
                                <label for="categoria_{{ category.id }}" class="btn btn-sm btn-default active">
                                    {{ category.category }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                        <!-- Status y fecha del post -->
                        <div class="col-xs-12 col-sm-6 pull-right _pl-0 _pr-0">
                            <div class="form-group col-xs-12 col-sm-8 _pl-30 _pr-0">
                                <label>Estado del Post</label><br>
                                {% for id, label in form.status.field.choices %}
                                <input type="radio" name="status" value="{{ id }}" id="id_status_post_{{ id }}" required
                                       {%if post%} readonly {%if post.status== id%} checked {%endif%}{%endif%}
                                />
                                <div class="btn-group">
                                    <label for="id_status_post_{{ id }}" class="btn btn-sm btn-default">
                                        <span class="glyphicon glyphicon-ok"></span>
                                        <span> </span>
                                    </label>
                                    <label for="id_status_post_{{ id }}" class="btn btn-sm btn-default active">
                                        {{ label }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="form-group col-xs-12 col-sm-4 _pl-0 _pr-0">
                                <label for="fecha">Fecha de publicación</label>
                                <div class='input-group date' id='fecha' name='fecha' style="width: 100%">
                                    <input type='text' id='published_date' name='published_date' class="form-control input-sm"
                                           value="{{ post.published_date|date:'YYYY-mm-dd HH:ii' }}" {%if post%}readonly{%endif%}/>
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                            <script type="text/javascript">
                                $(function () {
                                    $('#fecha').datetimepicker({
                                        showClear: true,
                                        showClose: true,

                                        format: 'YYYY-MM-DD hh:mm',
                                        locale: 'es'
                                    });
                                });


                            </script>
                        </div>
                    </div>
                    <!-- Imagen principal -->
                    <div class="form-group _mt-20">
                        <label for="tabla"> Imagen principal del post</label>
                        <table id="tabla">
                            <col style="width:5%">
                            <col style="width:60%">
                            <col style="width:15%">
                            <col style="width:15%">
                            <col>
                            <tbody>
                            <tr>
                                <td>

                                    <img id="image_prev" name="image_prev" width="100%" height="75px"
                                         {%if post.image.url %}src="{{ post.image.url }}" {%endif%}>
                                </td>
                                <td style="padding-left: 10px">
                                    <input id="image_name" name="image_name" type="text" class="form-control input-sm"
                                           placeholder="imagen principal del post..." readonly value="{{ post.image.name }}">
                                </td>
                                <td style="padding-left: 5px">
                                    <input id="image_size" name="image_size" type="text" class="form-control input-sm"
                                           placeholder="tamaño de la imagen..." readonly value="{{ post.image.size }}">
                                </td>
                                <td style="padding-left: 5px">
                                    <input id="image_dim" name="image_dim" type="text" class="form-control input-sm" readonly
                                           placeholder="dimensiones..." readonly value="{{ post.width_field }}x{{ post.height_field }}">
                                </td>
                                <td style="padding-left: 5px">
                                    <input id="id_image" name="image" type="file" class="hidden" accept=".gif,.jpg,.jpeg,.png"
                                           onchange="readURL(this);">
                                    <button id="image_btn" class="btn btn-sm _btnColor1" type="button" data-title="Edit">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- Imagenes del post -->
                    <div class="form-group _mt-20">
                        <label for="id_postimage">Resto de imagenes del post</label>
                        <div class="file-loading">
                            <input id="id_postimage" name="postimage" type="file" name="files[]" accept=".gif,.jpg,.jpeg,.png"
                                   class="btn _btnColor1" multiple>
                        </div>
                        <script>
                            {% if post %}
                                var
                                {% for aux in post.postimage_set.all %}
                                    img{{aux.id}} = "{{aux.image.url}}"{%if forloop.last%};{%else%},{%endif%}
                                {% endfor %}
                            {% endif %}
                            $(document).on('ready', function(){
                                $("#id_postimage").fileinput({
                                    initialPreview: [
                                        {% for aux in post.postimage_set.all %}
                                            img{{aux.id}},
                                        {% endfor %}
                                    ],
                                    initialPreviewAsData: true,
                                    initialPreviewConfig: [
                                        {% for aux in post.postimage_set.all %}
                                            {% verbatim %}{{% endverbatim %}
                                             caption: "{{aux.image.name}}",
                                             downloadUrl: "{{aux.image.url}}",
                                             size: {{aux.image.size}},
                                             width: {{aux.image.width}},
                                             height: {{aux.image.height}},
                                             key: {{ forloop.counter }}
                                             {% verbatim %}}{% endverbatim %},
                                        {% endfor %}
                                    ],
                                    overwriteInitial: true,
                                    maxFileSize: 1024,
                                    initialCaption: "Select your post files here",
                                    showUpload: false,
                                    allowedFileTypes: ['image']
                                });
                            });

                        </script>
                    </div>
                    <!-- Editor wysiwyg -->
                    <div class="form-group">
                        <label for="content">Contenido</label><br>
                        {% load wysiwyg %}
                        {% wysiwyg_setup %}
                        <textarea id="content" name="content">
                            {{ post.content }}
                        </textarea>
                        {% wysiwyg_editor "content" %}
                    </div>
                </div>
                <!-- Submit -->
                <div class="form-group pull-right _mt-0">
                    <button type="submit" type="button" class="btn _btnColor1 submit">
                        <i class="fa fa-cloud" aria-hidden="true"></i> Save post
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal delete -->
<div class="modal fade" id="delete">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-group">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h3>Delete image</h3>
                </div>
                <div class="form-group alert alert-danger">
                    <span class="glyphicon glyphicon-warning-sign"></span> Are you sure you want to delete this Record?
                </div>
                <div class="form-group form-inline">
                    <button type="button" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-ok"></span> Actualizar</button>
                    <button type="button" class="btn btn-info btn-sm" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block body_js %}
<script type="text/javascript">
$('#image_btn').click(function(){ $('#id_image').click(); })

function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            var image = document.getElementById("image_prev");
            image.src = e.target.result;
            $('#image_dim').val(e.target.result.width + "x" + e.target.result.height);
        };
        $('#image_size').val(input.files[0].size);
        $('#image_name').val(input.files[0].name);
        reader.readAsDataURL(id_image.files[0]);
    }
}

</script>
{% endblock %}
